#!/usr/bin/env bash
#
# Copyright (C) 2022 Anders Logg
# Licensed under the MIT License
#
# This script builds the documentation for the DTCC Platform
# by pulling documentation from all DTCC Components and then
# building a website using Docusaurus.

# Check that we are running the script from the root
if [ ! -f bin/dtcc-build-documentation ]; then
    echo "*** This script must be run from the root directory"
    exit 1
fi

# Initialize and get latest submodules
#git submodule update --init --recursive
#git submodule update --remote
git submodule init
git submodule update

# Get list of submodules
submodules=`git config --file .gitmodules --get-regexp path | awk '{ print $2 }'`

# Extract documentation for submodules
docdir="website/docs"
for submodule in $submodules; do
    echo "Extracting documentation for submodule $submodule..."
    cd $submodule
    git pull
    cd ..
    rm -rf $docdir/$submodule
    cp -r $submodule/doc $docdir/$submodule
done

# Add documentation for dtcc-doc itself
echo "Extracting documentation for dtcc-doc..."
mkdir -p $docdir/dtcc-doc
cp -r doc/* $docdir/dtcc-doc
